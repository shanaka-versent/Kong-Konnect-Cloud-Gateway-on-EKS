# External Secrets - MunchGo Cognito Configuration
# @author Shanaka Jayasundera - shanakaj@gmail.com
#
# Pulls Cognito User Pool configuration from AWS Secrets Manager into K8s Secret.
# The auth-service uses these values to call Cognito Admin APIs.
# The Secrets Manager secret is created by Terraform (cognito module).
#
# Secret naming convention in Secrets Manager:
#   <name_prefix>-munchgo-cognito-<random>
#
# After terraform apply, update the key below with:
#   terraform output cognito_secret_name

---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: munchgo-cognito-config
  namespace: munchgo
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: aws-secrets-manager
    kind: ClusterSecretStore
  target:
    name: munchgo-cognito-config
    creationPolicy: Owner
  data:
    - secretKey: COGNITO_USER_POOL_ID
      remoteRef:
        # Update with actual secret name from: terraform output cognito_secret_name
        key: PLACEHOLDER-munchgo-cognito
        property: user_pool_id
    - secretKey: COGNITO_APP_CLIENT_ID
      remoteRef:
        key: PLACEHOLDER-munchgo-cognito
        property: app_client_id
    - secretKey: COGNITO_REGION
      remoteRef:
        key: PLACEHOLDER-munchgo-cognito
        property: region
    - secretKey: COGNITO_ISSUER_URL
      remoteRef:
        key: PLACEHOLDER-munchgo-cognito
        property: issuer_url
